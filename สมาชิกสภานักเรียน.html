<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Stellar Council | นครบางยางพิทยาคม</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@400;600;700&family=Sarabun:wght@300;400;600&display=swap" rel="stylesheet">
    
    <script src="https://balkan.app/js/OrgChart.js"></script>

    <style>
        :root {
            --bg: #030712;
            --accent: #38bdf8;
            --border: rgba(255, 255, 255, 0.1);
            --glass: rgba(15, 23, 42, 0.85);
            --edge-gap: 25px; 
            --safe-top: calc(var(--edge-gap) + env(safe-area-inset-top, 0px));
        }

        body, html {
            margin: 0; padding: 0; width: 100%; height: 100%;
            background-color: var(--bg); color: white; overflow: hidden;
            font-family: 'Sarabun', sans-serif; touch-action: manipulation;
        }

        .universe-bg { position: fixed; inset: 0; background: radial-gradient(circle at center, #0f172a 0%, #030712 100%); z-index: -1; }

        /* UI Controls */
        .ui-controls-top {
            position: fixed; top: var(--safe-top); right: var(--edge-gap);
            display: flex; flex-direction: column; align-items: flex-end; gap: 15px; z-index: 9999;
        }

        .btn-back {
            position: fixed; top: var(--safe-top); left: var(--edge-gap); z-index: 9999;
            height: 48px; background: var(--glass); border: 1px solid var(--border);
            border-radius: 16px; color: white; display: flex; align-items: center; padding: 0 20px;
            text-decoration: none; font-size: 15px; font-weight: 600; backdrop-filter: blur(15px);
            box-shadow: 0 8px 32px rgba(0,0,0,0.5);
        }

        .search-container {
            height: 48px; background: var(--glass); border: 1px solid var(--border);
            backdrop-filter: blur(15px); border-radius: 24px;
            display: flex; align-items: center; transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            max-width: 48px; overflow: hidden; pointer-events: auto;
            box-shadow: 0 8px 32px rgba(0,0,0,0.5);
        }
        .search-container.active { max-width: 250px; padding-right: 15px; border-color: var(--accent); }
        .search-container i { width: 48px; height: 48px; display: flex; align-items: center; justify-content: center; color: var(--accent); cursor: pointer; flex-shrink: 0; }
        .search-container input { background: transparent; border: none; color: white; outline: none; width: 100%; font-size: 16px; opacity: 0; padding-left: 5px; }
        .search-container.active input { opacity: 1; }

        .btn-center {
            width: 48px; height: 48px; border-radius: 16px;
            background: var(--glass); border: 1px solid var(--border);
            color: white; backdrop-filter: blur(15px);
            display: flex; align-items: center; justify-content: center;
            font-size: 20px; transition: 0.3s; cursor: pointer;
            box-shadow: 0 8px 32px rgba(0,0,0,0.5);
        }

        /* --- ปรับปรุงส่วน Modal ให้รูปใหญ่ขึ้น --- */
        .stellar-modal {
            position: fixed; inset: 0; background: rgba(0,0,0,0.9);
            display: none; align-items: center; justify-content: center;
            z-index: 10001; opacity: 0; transition: 0.3s ease-out; padding: 20px;
        }
        .stellar-modal.active { display: flex; opacity: 1; backdrop-filter: blur(15px); }
        
        .modal-inner {
            width: 100%; max-width: 400px; /* เพิ่มความกว้างกล่อง */
            background: #0f172a; border: 1.5px solid var(--accent); 
            border-radius: 35px; padding: 30px; text-align: center;
            transform: scale(0.85) translateY(30px); transition: 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            box-shadow: 0 0 50px rgba(56, 189, 248, 0.15);
        }
        .stellar-modal.active .modal-inner { transform: scale(1) translateY(0); }

        .compact-portrait { 
            width: 100%; 
            max-width: 320px; /* ขยายรูปให้ใหญ่ขึ้น */
            aspect-ratio: 3/4;
            object-fit: cover; 
            border-radius: 25px; 
            border: 3px solid var(--accent); 
            margin-bottom: 20px; 
            box-shadow: 0 15px 35px rgba(0,0,0,0.4);
        }

        #mName { font-family: 'Kanit'; font-size: 1.6rem; font-weight: 700; margin: 5px 0; color: white; }
        #mTitle { color: var(--accent); font-size: 1.1rem; margin-bottom: 20px; font-weight: 400; }
        
        .quote-box {
            background: rgba(255,255,255,0.04); padding: 15px 20px; border-radius: 20px; 
            font-style: italic; font-size: 0.95rem; color: #cbd5e1; 
            border-left: 5px solid var(--accent); line-height: 1.5; text-align: left;
        }

        .close-btn { 
            width: 100%; padding: 14px; border-radius: 18px; border: none; 
            background: white; color: #030712; font-weight: 700; 
            margin-top: 25px; cursor: pointer; transition: 0.2s;
        }
        .close-btn:active { transform: scale(0.96); }

        #tree { width: 100%; height: 100%; background: transparent !important; }
        .boc-search { display: none !important; }
    </style>
</head>
<body>

    <div class="universe-bg"></div>

    <a href="index.html" class="btn-back">
        <i class="fas fa-home me-2"></i> หน้าหลัก
    </a>

    <div class="ui-controls-top">
        <div class="search-container" id="searchBox">
            <i class="fas fa-search" id="searchIcon"></i>
            <input type="text" id="searchInp" placeholder="ค้นหาชื่อ..." autocomplete="off">
        </div>
        <div class="btn-center" id="btnFit">
            <i class="fas fa-compress-arrows-alt"></i>
        </div>
    </div>

    <div id="tree"></div>

    <div class="stellar-modal" id="pModal">
        <div class="modal-inner" onclick="event.stopPropagation()">
            <img id="mImg" class="compact-portrait" src="">
            <h2 id="mName"></h2>
            <p id="mTitle"></p>
            <div class="quote-box">
                <p id="mQuote" class="mb-0"></p>
            </div>
            <button class="close-btn" id="closeBtn">ปิดหน้าต่าง</button>
        </div>
    </div>

    <script>
        var chart;

        // Custom Template สำหรับ OrgChart
        OrgChart.templates.stellar = Object.assign({}, OrgChart.templates.ana);
        OrgChart.templates.stellar.size = [180, 285]; 
        OrgChart.templates.stellar.node = '<rect x="0" y="0" height="285" width="180" fill="#1e293b" rx="20" ry="20" stroke="#334155" stroke-width="1"></rect>';
        
        OrgChart.templates.stellar.img_0 = '<clipPath id="pClip"><rect x="10" y="10" width="160" height="210" rx="14" ry="14"></rect></clipPath><image preserveAspectRatio="xMidYMid slice" clip-path="url(#pClip)" xlink:href="{val}" x="10" y="10" width="160" height="210"></image>';
        
        OrgChart.templates.stellar.field_1 = '<text style="font-size: 10px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.5px;" fill="#38bdf8" x="90" y="235" text-anchor="middle">{val}</text>';
        OrgChart.templates.stellar.field_0 = '<text style="font-size: 15px; font-weight: 600;" fill="#ffffff" x="90" y="255" text-anchor="middle">{val}</text>';
        OrgChart.templates.stellar.field_2 = '<text style="font-size: 12px; font-weight: 400;" fill="#94a3b8" x="90" y="272" text-anchor="middle">{val}</text>';
        
        OrgChart.templates.stellar.plus = '<line x1="10" y1="15" x2="20" y2="15" stroke="#38bdf8" stroke-width="2"></line><line x1="15" y1="10" x2="15" y2="20" stroke="#38bdf8" stroke-width="2"></line>';
        OrgChart.templates.stellar.minus = '<line x1="10" y1="15" x2="20" y2="15" stroke="#64748b" stroke-width="2"></line>';

        const rawNodes = [
            { id:1, name:"นางสาวณิชาพัฒน์ ยะโส", title:"ประธานนักเรียน", img:"สมาชิกสภานักเรียน/F.webp", quote:"ผู้นำคือผู้ที่สร้างแรงบันดาลใจให้ผู้อื่นก้าวไปข้างหน้า" },
            { id:2, pid:1, name:"นายนรวิทญ์ ทองแก้ว", title:"เลขานุการ", img:"สมาชิกสภานักเรียน/B2.webp", quote:"ระเบียบวินัยสร้างคน คนสร้างงานที่สมบูรณ์" },
            { id:3, pid:1, name:"นายสุขสิทธิ์ ภูมิอินทร์", title:"รองประธาน", img:"สมาชิกสภานักเรียน/B1.webp", quote:"การทำงานเป็นทีมคือหัวใจของสภานักเรียน" },
            { id:4, pid:1, name:"นายสิงหราช กาแก้ว", title:"เหรัญญิก", img:"สมาชิกสภานักเรียน/ST.webp", quote:"ความโปร่งใสคือพื้นฐานของความไว้วางใจ" },
            { id:5, pid:3, name:"นางสาวพิมพ์นารา อยู่ดี", title:"สมาชิก", img:"สมาชิกสภานักเรียน/PZ.webp", quote:"พลังเยาวชนคือพลังแห่งการเปลี่ยนแปลง" },
            { id:6, pid:3, name:"นางสาวศุกลภัทร วันคง", title:"สมาชิก", img:"สมาชิกสภานักเรียน/D.webp", quote:"มุ่งมั่น ตั้งใจ เพื่อส่วนรวม" },
            { id:7, pid:3, name:"นางสาวปานชนก ถอสูงเนิน", title:"สมาชิก", img:"สมาชิกสภานักเรียน/Pan.webp", quote:"ก้าวไปข้างหน้าด้วยความมั่นใจ" },
            { id:8, pid:3, name:"นางสาวพรพรรณ จันดา", title:"สมาชิก", img:"สมาชิกสภานักเรียน/Pat.webp", quote:"รอยยิ้มและมิตรภาพสร้างความสำเร็จ" },
            { id:9, pid:3, name:"นายธนภัทร แซ่ลี", title:"สมาชิก", img:"สมาชิกสภานักเรียน/P.webp", quote:"ทำทุกวันให้เป็นวันแห่งการเรียนรู้" },
            { id:10, pid:3, name:"นางสาวจรรยวรรณ์ ไชยวัชรนนท์", title:"สมาชิก", img:"สมาชิกสภานักเรียน/Mew.webp", quote:"ความเพียรพยายามไม่เคยทรยศใคร" },
            { id:11, pid:3, name:"นางสาวภาวินี แซ่หว้า", title:"สมาชิก", img:"สมาชิกสภานักเรียน/Bua.webp", quote:"ความสำเร็จอยู่ที่การลงมือทำ" },
            { id:12, pid:3, name:"นางสาววัชรินทร์ คุ้มแสง", title:"สมาชิก", img:"สมาชิกสภานักเรียน/NR.webp", quote:"วินัยเป็นรากฐานของชีวิต" }
        ];

        const processedNodes = rawNodes.map(node => {
            const parts = node.name.split(' ');
            return {
                ...node,
                firstName: parts[0],
                lastName: parts[1] || ""
            };
        });

        chart = new OrgChart(document.getElementById("tree"), {
            template: "stellar",
            mouseScrool: OrgChart.action.zoom,
            nodeMouseClick: OrgChart.action.expandCollapse,
            collapse: { level: 2, allChildren: true },
            nodeBinding: { 
                field_0: "firstName",
                field_1: "title", 
                field_2: "lastName",
                img_0: "img" 
            },
            nodes: processedNodes
        });

        // Search Logic
        const sBox = document.getElementById('searchBox');
        const sInp = document.getElementById('searchInp');
        const sIcon = document.getElementById('searchIcon');

        function resetSearch() {
            if(sBox.classList.contains('active')) {
                sBox.classList.remove('active');
                sInp.value = ""; sInp.blur();
            }
        }

        sIcon.addEventListener('click', (e) => {
            e.stopPropagation();
            if (sBox.classList.contains('active')) resetSearch();
            else { sBox.classList.add('active'); setTimeout(() => sInp.focus(), 300); }
        });

        document.addEventListener('click', () => resetSearch());
        sInp.addEventListener('click', (e) => e.stopPropagation());
        document.getElementById('btnFit').addEventListener('click', (e) => {
            e.stopPropagation(); resetSearch(); chart.fit();
        });

        // Modal Logic
        chart.on('click', function(sender, args){
            resetSearch();
            // เช็คว่ากดที่รูปภาพ (image) หรือโหนด
            if (args.event.target.tagName == 'image' || args.event.target.tagName == 'rect') {
                const node = chart.get(args.node.id);
                document.getElementById("mImg").src = node.img;
                document.getElementById("mName").innerText = node.name;
                document.getElementById("mTitle").innerText = node.title;
                document.getElementById("mQuote").innerText = `"${node.quote}"`;
                
                const modal = document.getElementById("pModal");
                modal.style.display = "flex";
                setTimeout(() => modal.classList.add("active"), 50);
                return false; 
            }
        });

        sInp.addEventListener('input', (e) => {
            const result = chart.search(e.target.value);
            if(result.length > 0) chart.center(result[0].id);
        });

        const closeModal = () => {
            const modal = document.getElementById("pModal");
            modal.classList.remove("active");
            setTimeout(() => modal.style.display = "none", 300);
        };
        document.getElementById("closeBtn").addEventListener('click', closeModal);
        document.getElementById("pModal").addEventListener('click', closeModal);

        window.onload = () => { chart.fit(); };
    </script>
</body>
</html>
